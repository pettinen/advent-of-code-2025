#!/usr/bin/env bash

set -o errexit -o nounset -o pipefail
shopt -s globstar

cd "$(dirname "$0")"

echo '<!-- This file is automatically generated by the `generate-readme` script. -->'
echo '# [Advent of Code 2025](https://adventofcode.com/2025)'
echo
echo '## Benchmarks'
echo

max_benchmark_len=0
days=()
benchmarks=()

for day in {01..12}; do
    cargo build -r 2> /dev/null

    if [[ -d day$day ]]; then
        benchmark=$(
            hyperfine --shell none --input "day$day/input" "target/release/day$day" 2> /dev/null \
	    | grep -Po '\d.+Â±\s+[\d.]+\s+\S+'
        )
        if (( ${#benchmark} > max_benchmark_len )); then
            max_benchmark_len=${#benchmark}
        fi
        days+=("$day")
        benchmarks+=("$benchmark")
    fi
done

echo -n '| Day | Benchmark '
for (( i = 9; i < max_benchmark_len; i += 1 )); do
    echo -n ' '
done
echo '|'
echo -n '|-----|-----------'
for (( i = 9; i < max_benchmark_len; i += 1 )); do
    echo -n -
done
echo '|'

for i in "${!days[@]}"; do
    echo -n '|  '
    printf %2d "${days[i]}"
    echo -n " | ${benchmarks[i]}"
    for (( j = ${#benchmarks[i]}; j <= max_benchmark_len; j += 1 )); do
        echo -n ' '
    done
    echo '|'
done

echo
echo '## Lines of code'
echo
echo '```'
wc --lines --total=always day??/src/**/*.rs
echo '```'
